---
import type { Props } from "@astrojs/starlight/props"
import BuiltinHead from "@astrojs/starlight/components/Head.astro"

// Based on https://hideoo.dev/notes/starlight-og-images/

// Get the URL of the generated image for the current page using its
// ID and replace the file extension with `.png`.
const ogImageUrl = new URL(
	`/og/${Astro.props.id.replace(/\.\w+$/, ".png")}`,
	Astro.site
)
---

<BuiltinHead {...Astro.props}>
	<script>
		// hack to navigate to the corresponding page expanding a sidebar group

		// considered overriding the component but Sidebar.astro is a huge amount
		// of logic to vendor for a small change

		// would love if there's a prop or more elegant way to do this in the future
		// and this can be deleted
		type SideBarGroup = Element & { hasListener?: true }

		const groups: SideBarGroup[] = Array.from(
			document.querySelectorAll(".group-label")
		)
		groups.forEach(group => {
			if ("hasListener" in group) return
			group.hasListener = true

			group.addEventListener("click", async () => {
				window.location.href = `${window.location.origin}/${group.textContent}`
			})
		})
	</script>
	<slot />
</BuiltinHead>

<meta property="og:image" content={ogImageUrl} />
<meta name="twitter:image" content={ogImageUrl} />
